<!DOCTYPE html>
<html>

<head>
  <title>My LIFF app</title>
</head>

<body>
  <h1>Your name is <span id="user_name"></span>, right?</h1>
  <p>status now is: <span id="user_status"></span></p>
  <button onclick="location.reload();">Reload the page</button>
  <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
  <script>
    let init = () =>{
      liff.init(
      data => {
          let user_status_span = document.getElementById("user_status");
          user_status_span.innerText = "init started"

          const user_id = data.context.userId;
          const access_token = liff.getAccessToken();

          liff.getProfile()
          .then(profile => {
            const user_name = profile.displayName;
            let user_name_span = document.getElementById("user_name");
            user_name_span.innerText = user_name;
          })
          .catch(err =>{
            console.log('err', err);
          });

          data_url = "https://2t82fs2tia.execute-api.ap-northeast-1.amazonaws.com/dev/data/?access_token=" + access_token;
          let data_json;
          fetch(data_url)
          .then(res =>{
            if(res.ok){
              user_status_span.innerText = "access url correctly."
              return response.json();
            }
          })
          .then(data =>{
            data_json = data;
          })
          .catch(err =>{
            user_status_span.innerText = "access url fail: " + err.toString();
            console.log(err);
          });


        },
      err => {
          // LIFF initialization failed
      }
      )
    };

    window.onload = init();
  </script>
</body>

</html>